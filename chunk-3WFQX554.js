import{b as w,c as D}from"./chunk-2WW22MLQ.js";import"./chunk-VZSSPM6Z.js";import{a as x,b as _,c as I,f as W,g as E}from"./chunk-4TPATSYR.js";import"./chunk-6K3Y7BDI.js";import"./chunk-EYALUUED.js";import{Hb as u,Oa as a,S as C,Wb as i,X as y,Xb as l,bb as M,ma as c,rb as g,tb as S,ub as v,wb as n,xb as o}from"./chunk-WWHZWTZN.js";import"./chunk-2NFLSA4Y.js";var k=class r{leakyStatus=c("No connection");leakyMessages=c([]);properStatus=c("No connection");properMessages=c([]);leakySocket=null;leakyInterval=null;properSocket=null;properInterval=null;connectLeaky(){this.connect(!0)}connectProper(){this.connect(!1)}connect(t){try{let e=new WebSocket("wss://echo.websocket.org/"),s=t?"\u274C Leaky":"\u2713 Proper",p=t?"Leaky":"Proper",f=t?this.leakyStatus:this.properStatus,b=t?this.leakyMessages:this.properMessages;e.onopen=()=>{let m=t?"Connected (never closed!)":"Connected (will be closed)";f.set(m),console.log(`${s}: WebSocket connected`);let d=0,h=window.setInterval(()=>{d++,e?.send(`${p} message ${d}`)},1e3);t?(this.leakyInterval=h,this.leakySocket=e):(this.properInterval=h,this.properSocket=e)},e.onmessage=m=>{let d=b();b.set([...d,`\u{1F4E9} ${m.data}`]),console.log(`${s} received:`,m.data)},e.onclose=()=>{f.set("Closed")},t?this.leakySocket=e:this.properSocket=e}catch{(t?this.leakyStatus:this.properStatus).set("Connection failed")}}closeProper(){this.properSocket&&(this.properSocket.close(),this.properInterval&&(clearInterval(this.properInterval),this.properInterval=null),console.log("\u2713 Closed: WebSocket connection closed"),this.properStatus.set("Manually closed"))}cleanup(){this.properSocket&&(this.properSocket.close(),this.properInterval&&clearInterval(this.properInterval),console.log("\u2713 Cleanup: WebSocket closed and messages stopped"))}static \u0275fac=function(e){return new(e||r)};static \u0275prov=C({token:r,factory:r.\u0275fac,providedIn:"root"})};function N(r,t){if(r&1&&(n(0,"div"),i(1),o()),r&2){let e=t.$implicit;a(),l(e)}}function O(r,t){if(r&1&&(n(0,"div"),i(1),o()),r&2){let e=t.$implicit;a(),l(e)}}var P=class r{service=y(k);ngOnDestroy(){console.log("\u{1F5D1}\uFE0F WebSocketsComponent destroyed"),this.service.cleanup()}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=M({type:r,selectors:[["app-websockets-section"]],decls:29,vars:2,consts:[[1,"example-section"],["mat-raised-button","",3,"click"],[1,"log"],[1,"messages"],["mat-raised-button","","color","primary",3,"click"]],template:function(e,s){e&1&&(n(0,"mat-card")(1,"mat-card-header")(2,"mat-card-title"),i(3,"WebSocket Memory Leaks"),o()(),n(4,"mat-card-content")(5,"p"),i(6," WebSocket connections remain open and consume resources if not explicitly closed when the component is destroyed. "),o(),n(7,"div",0)(8,"h3"),i(9,"\u274C Memory Leak Example"),o(),n(10,"button",1),u("click",function(){return s.service.connectLeaky()}),i(11," Open Connection (Leaky) "),o(),n(12,"div",2),i(13),o(),n(14,"div",3),S(15,N,2,1,"div",null,g),o()(),n(17,"div",0)(18,"h3"),i(19,"\u2713 Correct Example"),o(),n(20,"button",4),u("click",function(){return s.service.connectProper()}),i(21," Open Connection (Cleaned) "),o(),n(22,"button",1),u("click",function(){return s.service.closeProper()}),i(23,"Close Connection"),o(),n(24,"div",2),i(25),o(),n(26,"div",3),S(27,O,2,1,"div",null,g),o()()()()),e&2&&(a(13),l(s.service.leakyStatus()),a(2),v(s.service.leakyMessages()),a(10),l(s.service.properStatus()),a(2),v(s.service.properMessages()))},dependencies:[E,x,I,W,_,D,w],styles:[".messages[_ngcontent-%COMP%]{margin:8px 0 0;padding:8px;background-color:#fff;border-left:3px solid #4caf50;font-family:monospace;font-size:11px;color:#333;max-height:150px;overflow-y:auto}.messages[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin:4px 0;padding:4px;background-color:#f5f5f5}"],changeDetection:0})};export{P as WebSocketsComponent};
